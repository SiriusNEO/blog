<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="前言快速傅里叶变换（Fast Fourier Transformation，简称 FFT），用于大整数乘法与多项式乘法&#x2F;卷积的高效计算，其复杂度可以达到非常令人惊叹的 $O(n \log n)$ 。之所以这么说，就是因为这个问题看起来好像就感觉只能用 $O(n^2)$ 的算法来解决，并且直觉上似乎并没有什么优化空间的样子。而 FFT 用堪称艺术的巧妙取点和分治，非常优雅地解决了这个问题。 为什么突">
<meta property="og:type" content="article">
<meta property="og:title" content="分治艺术的顶点，快速傅里叶变换">
<meta property="og:url" content="https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/index.html">
<meta property="og:site_name" content="Metric Space | 度量空间">
<meta property="og:description" content="前言快速傅里叶变换（Fast Fourier Transformation，简称 FFT），用于大整数乘法与多项式乘法&#x2F;卷积的高效计算，其复杂度可以达到非常令人惊叹的 $O(n \log n)$ 。之所以这么说，就是因为这个问题看起来好像就感觉只能用 $O(n^2)$ 的算法来解决，并且直觉上似乎并没有什么优化空间的样子。而 FFT 用堪称艺术的巧妙取点和分治，非常优雅地解决了这个问题。 为什么突">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-03-03T16:57:27.000Z">
<meta property="article:modified_time" content="2023-10-09T03:59:08.896Z">
<meta property="article:author" content="Chaofan">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/android-chrome-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>分治艺术的顶点，快速傅里叶变换</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Articles</a></li><!--
     --><!--
       --><li><a href="/links/">Links</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://chaofanlin.com">Academic Page</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2022/03/06/%E5%88%BB%E7%94%BB%E9%9B%86%E5%90%88%E5%A4%A7%E5%B0%8F%E7%9A%84%E7%90%86%E8%AE%BA%EF%BC%8C%E6%B5%8B%E5%BA%A6%E8%AE%BA%E5%88%9D%E6%AD%A5/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2021/11/30/%E7%81%AB%E9%BE%99%E6%9E%9C%E5%91%B3%E7%9A%84%E8%BF%91%E5%86%B5%E9%9A%8F%E8%AE%B0/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&text=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&title=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&is_video=false&description=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=分治艺术的顶点，快速傅里叶变换&body=Check out this article: https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&title=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&title=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&title=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&title=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&name=分治艺术的顶点，快速傅里叶变换&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&t=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Brute-Force"><span class="toc-number">3.</span> <span class="toc-text">Brute-Force</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Karatsuba"><span class="toc-number">4.</span> <span class="toc-text">Karatsuba</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%82%B9%E5%80%BC%E8%A1%A8%E7%A4%BA"><span class="toc-number">5.</span> <span class="toc-text">为什么要点值表示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DFT-%E9%AB%98%E6%95%88%E5%9C%B0%E4%BB%8E%E7%B3%BB%E6%95%B0%E8%A1%A8%E7%A4%BA%E5%88%B0%E7%82%B9%E5%80%BC%E8%A1%A8%E7%A4%BA"><span class="toc-number">6.</span> <span class="toc-text">DFT-高效地从系数表示到点值表示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IDFT-%E9%AB%98%E6%95%88%E5%9C%B0%E4%BB%8E%E7%82%B9%E5%80%BC%E8%A1%A8%E7%A4%BA%E5%88%B0%E7%B3%BB%E6%95%B0%E8%A1%A8%E7%A4%BA"><span class="toc-number">7.</span> <span class="toc-text">IDFT-高效地从点值表示到系数表示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%80%83%E6%80%BB%E7%BB%93"><span class="toc-number">8.</span> <span class="toc-text">思考总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTT"><span class="toc-number">9.</span> <span class="toc-text">NTT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">10.</span> <span class="toc-text">代码</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <!-- <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> -->
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        分治艺术的顶点，快速傅里叶变换
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Chaofan</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-03-03T16:57:27.000Z" class="dt-published" itemprop="datePublished">2022-03-04</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E6%8E%8C%E4%B8%8A%E7%9A%84%E7%BA%AF%E5%85%89/">掌上的纯光</a>
    </div>


      

      <!-- | <i class="fa fa-eye fa-fw post-meta-icon"></i><span id="busuanzi_container_site_pv"> Views: <span id="busuanzi_value_page_pv"></span></span> -->
      | <i class="far fa-file-word fa-fw post-meta-icon"></i> Total Words: 29k
      | <i class="far fa-clock fa-fw post-meta-icon"></i> Reading Time: 26 mins.
    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>快速傅里叶变换（Fast Fourier Transformation，简称 FFT），用于大整数乘法与多项式乘法/卷积的高效计算，其复杂度可以达到非常令人惊叹的 $O(n \log n)$ 。之所以这么说，就是因为这个问题看起来好像就感觉只能用 $O(n^2)$ 的算法来解决，并且直觉上似乎并没有什么优化空间的样子。而 FFT 用堪称艺术的巧妙取点和分治，非常优雅地解决了这个问题。</p>
<p>为什么突然想写这个算法呢？直接原因是，这一算法是我的算法课 “Divide and Conquer” 这一章所讲的最后一个算法。当然，我早已经不是第一次听到了——高中搞 OI 时候就学过一遍；在面试 ACM 班时被问及我最喜欢的算法时，我不假思索地回答了 FFT；上学期的科学计算课程（看起来和 FFT 八竿子打不着的数学课）也讲到了它，足以说明这一算法的魅力所在。可以说，我和它的缘分也是不浅了。</p>
<p>我一直认为，只要一个算法，或者说一个想法，具有令人惊叹、或者可以让人发自内心地赞叹“优美、巧妙”的地方，就已经有足够的价值了；至于它是否能被应用，其实也没那么重要。但 FFT 不仅巧妙绝伦，它还非常有用——因为它解决的问题实在是太基本了。</p>
<p>这大概就是这篇文章诞生的目的了。如果你此时能为“不知道 FFT”感到遗憾的话，那就看下去吧！</p>
<hr>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>因为大整数乘法其实本质就是多项式乘法，所以这里我们就直接来研究多项式乘法问题。</p>
<p>给定两个多项式 $F(x) = \sum_{i=0}^n a_i x^i $, $G(x) = \sum_{i=0}^m b_i x^i $, 求 $F(x) \cdot G(x)$. 你只要输出这个相乘后的多项式的系数就好。</p>
<hr>
<h2 id="Brute-Force"><a href="#Brute-Force" class="headerlink" title="Brute-Force"></a>Brute-Force</h2><p>直观想法，当然是直接相乘啦~</p>
<p>我们考虑相乘后多项式项 $x^k$ 前的系数，可以采取一个比较组合的观点来看：可以是 $F(x)$ 中的 1 乘以 $G(x)$ 中的 $x^k$, 也可以是$F(x)$ 中的 $x$ 乘以 $G(x)$ 中的 $x^{k-1}$ … …</p>
<p>我们把这个想法写成式子，就是</p>
<script type="math/tex; mode=display">
\sum_{i+j=k} a_i b_j x^k</script><p>这个复杂度是多少呢？考虑相乘后的多项式长度为 $n+m-1$，我们枚举这个多项式的每一项，且每一项前面都有一个求和号，所有满足条件的 $i+j=k$ 有 $k+1$ 对，因此总复杂度为 $O(n^2)$（这里为了方便，我们不妨认为 $n$ 与 $m$ 是同一量级）</p>
<h2 id="Karatsuba"><a href="#Karatsuba" class="headerlink" title="Karatsuba"></a>Karatsuba</h2><p>这个优化方法是我在算法课上学到的，虽然不及 FFT 优秀，但是能将 n 上的系数从 2 优化成 1.x，而且想法也比较简单。</p>
<p>考虑我们计算两位数乘法</p>
<script type="math/tex; mode=display">
\overline{ab} \times \overline{cd} = (10a+b)(10c+d) = 100ac+10ad+10bc+bd = 100ac+10(ad+bc)+bd</script><p>那么两位数乘法需要花费 4 单位的时间。我们考虑式子展开后，需要计算 $ac, ad, bc, bd$ 四个一位数乘法，也需要 4 单位的时间。</p>
<p>算法的关键部分来了：我们其实并不需要计算 4 个东西的乘法，因为我们实际关心的是 $ac, ad+bc, bd$ 三个式子。我们考虑如果我们计算 $(a+b)(c+d), ac, bd$ 三个乘法，是不是就可以通过加减法得到我们要的三个式子了。</p>
<p>当然直接用两位数乘法来讲，可能会导致你产生一些关于计算模型上的疑惑（比如乘以 100 要花费多少时间？$(a+b)(c+d)$ 这一项是一位数乘法还是两位数？）这些都不重要，我们直接把这个思想用于多项式中，这样你就知道这一算法的优化之处了。</p>
<p>为了方便暂时设两个多项式长度相同，记</p>
<script type="math/tex; mode=display">
F(x) = f_1(x) + f_2(x) x^{n/2},\ G(x) = g_1(x) + g_2(x) x^{n/2}</script><p>那么</p>
<script type="math/tex; mode=display">
F(x) \cdot G(x) = [f_1(x) + f_2(x) x^{\frac{n}{2}}] [g_1(x) + g_2(x) x^{\frac{n}{2}}] \\
= f_1(x) g_1(x) + [f_2(x) g_1(x) + f_1(x) g_2(x)] x^{\frac{n}{2}} + f_2(x) g_2(x) x^n</script><p>其中 $f_1, f_2, g_1, g_2$ 均为长度为 $\frac{n}{2}$ 的多项式。应用上面的方法，我们也只要计算三个多项式的乘积：$(f_1+f_2)(g_1+g_2), f_1g_1, f_2g_2$. 这样我们的时间复杂度递推式就可以写作</p>
<script type="math/tex; mode=display">
T(n) = 3T(\frac{n}{2}) + O(n)</script><p>应用 Master Theorem（当然你也可以用你高超的数学技巧）可以求出复杂度为 $O(n^{\log_2 3})$，大约是 $O(n^{1.6})$. 这一算法被称为 Karatsuba 算法。</p>
<hr>
<h2 id="为什么要点值表示"><a href="#为什么要点值表示" class="headerlink" title="为什么要点值表示"></a>为什么要点值表示</h2><p>前面讲了那么多其它做法，始终没有来到正题。</p>
<p>虽然 Karatsuba 已经比较巧妙了，但我们仍能感觉到其中的瓶颈——你总是得算点什么东西。并且已经证明了每次算“3”个多项式已经是最少的了（如果你能做到每次转化成算两个 $T(\frac{n}{2})$ 的操作，那你就做到了线性复杂度！）</p>
<p>所以我们需要来一个思路上的转变。FFT 第一个能够优化的关键，就是它使用点值表达，而非系数表达的方式来考虑一个多项式，进而能够使得乘法操作变得非常简单。</p>
<p>什么叫点值表达呢？我们知道一个多项式的所有系数，当然可以确定它；但我们只要知道其之上足够多的点，我们也能确定它。事实上，对于 n 次多项式，我们只要知道 n+1 个不同的点就可以做到。下面我们进行一个简单的证明。</p>
<p>考虑现在你有点值 $(x_0, F(x_0)), (x_1, F(x_1)), \dots, (x_n, F(x_n))$，我们先做一个待定系数</p>
<script type="math/tex; mode=display">
F(x) = a_0 + a_1 x + \dots + a_n x^n</script><p>我们把系数当成未知数，只要我们的信息量足够解出它们就可以了。因此我们得到方程</p>
<script type="math/tex; mode=display">
\left[\begin{matrix}  
F(x_0) \\  
F(x_1) \\  
\vdots \\  
F(x_n)  
\end{matrix}\right]  
=  
\left(\begin{matrix}  
1 & x_0 & \dots & x_0^n \\  
1 & x_1 & \dots & x_1^n \\  
\vdots & \vdots & & \vdots \\  
1 & x_n & \dots & x_n^n  
\end{matrix}\right)  
\left[\begin{matrix}  
a_0 \\  
a_1 \\  
\vdots \\  
a_n  
\end{matrix}\right]</script><p>注意到这是一个 Vandermonde 矩阵，因此其可逆。所以此方程有唯一解，这就证明了 n+1 个点的点值信息可以唯一确定此多项式。</p>
<p>但其实我们日常生活中谈论“多项式”，点值表示其实非常少用。毕竟在做数学作业时，你也不会拿着一些点，然后称其为“多项式”吧？所以在这里特地提到这一表示法，它肯定有其优势之处——在解决我们的乘法问题方面。</p>
<p>考虑一开始的乘法问题 $F(x) \cdot G(x)$，我们现在如果用点值的观点去思考，就不用去算它的系数了——我们只要找到相当于它“次数+1”（在我们的预设中，即为 $n+m+1$）个点。那我们只要选定 $x_0, x_1, \dots, x_{n+m+1}$ 个横坐标，求出 $F(x_i)$ 与 $G(x_i)$ 的点值，那么乘法结果在此处的点值即为 $F(x_i) \cdot G(x_i)$.</p>
<p>你可以注意到，我们的乘法 $F(x_i) \cdot G(x_i)$ 在这时只需要 $n+m+1$ 次！我们采用点值表示的方法，绕开了多项式系数那些“相互组合”的情况，比较本质地把这个“乘法”给体现出来了。</p>
<p>但坏消息是，得到 $F(x_i)$ 与 $G(x_i)$ 似乎不是个很高效的事情。简单来想，我们将一个值代入 n 次多项式，似乎时间复杂度不可能低于 $O(n)$。所以这样想来，好像求出所有的 $F(x_i)$ 与 $G(x_i)$ 复杂度也是 $O(n^2)$。不过，这似乎看起来要比简单的系数乘法要有前景一点。而优化这一步，正是 FFT 的最核心之处。</p>
<hr>
<h2 id="DFT-高效地从系数表示到点值表示"><a href="#DFT-高效地从系数表示到点值表示" class="headerlink" title="DFT-高效地从系数表示到点值表示"></a>DFT-高效地从系数表示到点值表示</h2><p>我们在回顾上一步，现在我们第一步需要从系数表示快速地求得点值表示。</p>
<p>重新考虑这个方程（实际上，这个方程就是沟通两个表示法的方程）</p>
<script type="math/tex; mode=display">
\left[\begin{matrix}  
F(x_0) \\  
F(x_1) \\  
\vdots \\  
F(x_n)  
\end{matrix}\right]  
=  
\left(\begin{matrix}  
1 & x_0 & \dots & x_0^n \\  
1 & x_1 & \dots & x_1^n \\  
\vdots & \vdots & & \vdots \\  
1 & x_n & \dots & x_n^n  
\end{matrix}\right)  
\left[\begin{matrix}  
a_0 \\  
a_1 \\  
\vdots \\  
a_n  
\end{matrix}\right]</script><p>写成这样，也就不难理解我们上一部分所说的 $O(n^2)$ 复杂度了——暴力地进行矩阵乘以向量，当然是平方啦。但 FFT 是怎么优化到 $O(n \log n)$ 的呢？</p>
<p>设计算法第一原则：每当我们想要优化算法时，想想我们现在的算法重复干了什么事，以及有什么信息没有用到。（当然，这是我自己编的）</p>
<p>似乎看上去，我们并没有在重复干事情。但我们可以很快意识到，我们忽略了一些条件，或者说变相加强了问题——我们在研究任意取点 $x_0, x_1, \dots, x_n$ 的情况，但取点完全可以由我们自己决定。</p>
<p>首先，我们肯定会趋向代入一些，尽量让计算简单的情况——比如 $x=0$。算都不用算！但你需要继续找 $n+m$ 个像 0 这样特殊的点，这对于数据规模越来越大的情况实在不是很可行。</p>
<p>所以，我们不能想着找“若干个”特殊点，而应该找“若干类”，或者说想办法让点与点之间有关联、有大量重复部分，进而简化计算。</p>
<p>考虑我们取 $x_0 = 1, x_1 = -1$ 两个（看起来就很有关系）的对偶点，代入得到</p>
<script type="math/tex; mode=display">
F(1) = a_0 + a_1 + \dots + a_n \\ 
F(-1) = a_0 - a_1 + \dots + (-1)^n a_n</script><p>假如我们记奇数部分的和为 $f_1$，偶数部分的和为 $f_2$，那么有 $F(1)=f_1+f_2, F(-1)=f_1-f_2$。而计算 $f_1, f_2$ 的总和时间为 $n$（而不是 $2n$！），也就意味着这两个点值的计算，我们只花费了一个 $n$。</p>
<p>而这样的点对关系其实并不特殊——任意两个互为相反数的取点都能做到。假设我们能够对于 $f_1$ 与 $f_2$ 这种部分不断往下如此做，即</p>
<script type="math/tex; mode=display">
F(x) = (a_0+a_2 x^2 + a_4 x^4 + \dots) + x (a_1 + a_3 x^2 + a_5 x^4 + \dots) \\  
F(-x) = (a_0+a_2 x^2 + a_4 x^4 + \dots) - x (a_1 + a_3 x^2 + a_5 x^4 + \dots)</script><p>我们就能得到递推式</p>
<script type="math/tex; mode=display">
T(n) = 2 T(\frac{n}{2}) + O(n)</script><p>注意这里的 n 表示的是点的个数（按上面的假设其实应该是 n+1，不过讨论复杂度并不用关心），我们本来要求 n 个点的点值，但因为我们的取点是 $x_0, -x_0, x_1, -x_1, \dots$，我们只需要计算其中一半（比如都为正的那一半）的取点情况。</p>
<p>注意上面有个前提：“如果我们能一直做下去”。假设这个成立的话，根据上述递推式也很容易求出时间复杂度为 $O(n \log n)$。但很遗憾，这个前提明显是不成立的——事实上，应该是“一定不”。因为假设原问题的点是 $x_0, -x_0, x_1, -x_1, \dots$，那么子问题的点就是 $x_0^2, x_1^2, \dots$，如果子问题还能像这样“相反数配对”的话，即有 $x_i^2=-x_j^2$，得到 $x_i=x_j=0$（如果是在实数域讨论的话）</p>
<p>相信读者已经发现端倪了——实数域确实无法找到，但在复数域似乎大有可为。如果考虑复数域，$x_i^2=-x_j^2$ 即为 $x_i=i x_j$（注意 i 在此处有点重名，注意辨别复数单位 i 与下标 i）</p>
<p>因此假设我们需要快速对 4 个取点的情况进行计算，首先我们当然取 $1, -1$ 两个比较方便的相反数。又根据上面，$i, -i$ 也要纳入我们的考量。 我们进行一次子问题转换：$1, -1, i, -i$ 变为 $1, -1$，能够继续进行下去！</p>
<p>事实上，这些特殊的点就是复数域上的 $n$ 次单位根。“相反数”在复数的空间上其实就是相差 $ \pi $ 的角度，而“乘以 i”则相当于相差 $ \frac{\pi}{2} $ 的角度。所以一组符合上面条件的 4 个取点实际上就是一个“十字架”。</p>
<p>我们可以再来手模一下 8 个点的过程，我们取 8 次单位根，按照正负-正负分组，每次进行一次平方操作往下变换：</p>
<script type="math/tex; mode=display">
\begin{matrix}  
1 & -1 & i & -i & \sqrt{i} & -\sqrt{i} & \sqrt{-i} & -\sqrt{-i} \\  
1 & -1 & i & -i \\  
1 & -1 \\  
1  
\end{matrix}</script><p>这样，我们就做到了在 $O(n \log n)$ 中高效地转换点值表达式了。这一过程被称为 DFT（Discrete Fourier Transform，离散傅里叶变换）。</p>
<p>接下来，相乘的时间复杂度是线性的，所以我们似乎已经得到了结果——但是之前说过，实际生活中通常期望我们的结果表示成系数的表达方法，因此我们还需要考虑能否高效地将点值表达式转回系数表达式。</p>
<hr>
<h2 id="IDFT-高效地从点值表示到系数表示"><a href="#IDFT-高效地从点值表示到系数表示" class="headerlink" title="IDFT-高效地从点值表示到系数表示"></a>IDFT-高效地从点值表示到系数表示</h2><p>重新考虑那个方程，为了方便我们记函数值的向量为 $Y$, 矩阵为 $X$, 系数向量为 $\alpha$，将方程重写为</p>
<script type="math/tex; mode=display">
Y = X \alpha</script><p>我们知道取 n 次单位根作为横坐标时（记此时的矩阵 $X$ 为一个特殊的矩阵 $W$），我们已经能高效从 $\alpha$ 得到 $Y$。而现在相当于我有 $Y$，并且矩阵还是 $W$（这里不能再自己取值了，因为我们求乘积所用的 $F$ 和 $G$ 的点值表达所取的横坐标是 n 次单位根，那乘积的点值表达也只能是这些横坐标）</p>
<p>已经证明 $W$ 是可逆的，因此我们只需要能够比较快速地计算</p>
<script type="math/tex; mode=display">
\alpha = W^{-1} Y</script><p>这里涉及到两个难题：求逆和乘法。我们知道矩阵求逆可不是一件轻松的事，一般的矩阵需要 $O(n^3)$。但我们既然都跟着 FFT 做到这一步了，说明 $W$ 一定有某种奇妙的性质使得它可以快速求逆。</p>
<p>这里就要点一下题了，我们来看 FFT 的全称“快速傅里叶变换”。学过分析的同学可能都知道傅里叶变换，之所以 FFT 和分析里的傅里叶变换本质是一样的，是因为复数域的单位根和三角函数在某种意义上是一样的——其实分析里的傅里叶变换用复数的形式写，就很能看出它们的关系了。</p>
<p>因此，我们不难从傅里叶变换来猜想，$W$ 是否可能具有某种正交性？如果其为正交矩阵，那它求逆可太简单了——就是它的共轭转置（正交矩阵满足 $W^H W = E$）。</p>
<p>观察到 $W$ 其实是个对称矩阵，因此 $W^H$ 只要把其元素取共轭就好了。我们观察 $W$ 的形态（假设对于取 $n+1$ 个点的情况，我们取 $n+1$ 次单位根）</p>
<script type="math/tex; mode=display">
\left(\begin{matrix}  
1 & 1 & 1 & \dots & 1 \\  
1 & \omega & \omega^2 & \dots & \omega^n \\  
1 & \omega^2 & \omega^4 & \dots & \omega^{2n} \\  
\vdots & \vdots & \vdots & & \vdots \\  
1 & \omega^n & \omega^{2n} & \dots & \omega^{n^2}  
\end{matrix}\right)</script><p>因此 $W^HW$ 的 $(i, i)$（也即对角线位置一定是）</p>
<script type="math/tex; mode=display">
1 + \overline{\omega^{i+1}}\omega^{i+1} + \overline{\omega^{2(i+1)}}\omega^{2(i+1)} + \dots + \overline{\omega^{n(i+1)}}\omega^{n(i+1)} = n+1</script><p>而非对角线部分，$(i, j)$</p>
<script type="math/tex; mode=display">
\begin{aligned}
&1 + \overline{\omega^{i+1}}\omega^{j+1} + \overline{\omega^{2(i+1)}}\omega^{2(j+1)} + \dots + \overline{\omega^{n(i+1)}}\omega^{n(j+1)} \\ =\ &1 + \omega^{i-j} + \omega^{2(i-j)} + \dots + \omega^{n(j-i)} \\  
=\ &\frac{1-\omega^{(n+1)(j-i)}}{1-\omega^{j-i}} = 0
\end{aligned}</script><p>这里你需要几个基本的数学知识</p>
<ul>
<li>对于一个复数 $\omega$，$ \overline{\omega} \omega = \omega ^2 $。上文中均为单位根，所以模长为 1。</li>
<li>对于复数我们也可以应用等比数列求和公式。</li>
<li>对于 $n+1$ 次单位根，$ \omega^{n+1} = 1 $。</li>
</ul>
<p>因此我们得到其“基本是正交的”（在分析里，其实可以认为这就是正交的；不过在矩阵的定义中，正交矩阵相乘一定要等于 $E$ 而非 $cE$）。也即我们已经证明了</p>
<script type="math/tex; mode=display">
W^H W = (n+1) E</script><p>所以我们有</p>
<script type="math/tex; mode=display">
\alpha = W^{-1} Y = \frac{1}{n+1} W^H Y</script><p>所以求逆我们实际上不需要花时间。但是我们还需要考虑矩阵乘法的事。我们来考量 $W^H$ 的形态：</p>
<script type="math/tex; mode=display">
\left(\begin{matrix}  
1 & 1 & 1 & \dots & 1 \\  
1 & \omega^{-1} & \omega^{-2} & \dots & \omega^{-n} \\  
1 & \omega^{-2} & \omega^{-4} & \dots & \omega^{-2n} \\  
\vdots & \vdots & \vdots & & \vdots \\  
1 & \omega^{-n} & \omega^{-2n} & \dots & \omega^{-n^2}  
\end{matrix}\right)</script><p>其中共轭用单位根的负指数表示，因为共轭实际上就是等价于某种倒数，或者说乘法逆元。我们惊喜地发现这和 $W$ 相比，只是把所有指数都换成了负号而已！那我们已经可以高效计算 $W$ 与一个向量相乘了，那$W^H$ 与一个向量相乘，我们似乎也应该能够很高效地计算——事实上确实是这样的。</p>
<p>这是因为，我们能让算法高效进行的关键部分都保留住了。我们能让这个相乘高效进行，本质就是因为单位根良好的旋转对称性，而取负的单位根无非就是旋转方向从逆时针变成了顺时针，其它没有任何改变。所以如果你的 DFT 函数接口设计得好的话，你只要调用你已经写好的 DFT，只要在传参时候把单位根的选取变成它们的共轭，就可以完成这个过程。</p>
<p>这个过程被称为 IDFT，也就是 DFT 的逆变换。至此，我们的 FFT 算法就完成了。</p>
<hr>
<h2 id="思考总结"><a href="#思考总结" class="headerlink" title="思考总结"></a>思考总结</h2><p>讲了这么多，还是觉得很不可思议。到底是什么性质能让我们如此高效地计算呢？我们可以做一下简单的归纳总结。首先，我们可以先梳理一下 FFT 的算法过程。</p>
<ul>
<li>Step 1. DFT，用 n 次单位根高效计算 F 与 G 的 n+m+1 个点值。</li>
<li>Step 2. 乘法。将 F 与 G 的对应点值相乘，得到 $F \cdot G$ 的 n+m+1 个点值。</li>
<li>Step 3. IDFT。将 $F \cdot G$ 还原成系数形式。</li>
</ul>
<p>我们发现，点值表达式的优越性是这个算法的关键一步——这是一个很棒的想法。它启示我们，其实当我们要求一个东西时，并不一定要按定义将其求出来，我们只要致力于得到“能够确定目标的信息量”就足够了。</p>
<p>当然，FFT 算法的灵魂还是 n 次单位根的使用。其能进行高效地分治，本质原因是良好的对称性；而在 IDFT 化归为 DFT 的分析中，我们又用到了它的正交性。这才是 FFT 真正实现 $n \log n$ 最为重要的一环。</p>
<hr>
<h2 id="NTT"><a href="#NTT" class="headerlink" title="NTT"></a>NTT</h2><p>虽然 FFT 已经很完美了，但是在实际实现过程中，由于复数域的 n 次单位根通常需要用实数表示，所以存在精度误差的问题。</p>
<p>NTT（Number Theory Transformation，数论变换）则使用数论中的“原根”来代替 FFT 中的单位根。在模意义下，原根具有和单位根相同的性质，并且因为 NTT 全程均使用整数，消除了精度误差，因此也常用于替代 FFT。</p>
<hr>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>可以通过洛谷模板题的代码。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = (<span class="number">1</span>&lt;&lt;<span class="number">22</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Complex</span> &#123;</span><br><span class="line">    <span class="type">double</span> re, im;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Complex</span>() : <span class="built_in">re</span>(<span class="number">0.0</span>), <span class="built_in">im</span>(<span class="number">0.0</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Complex</span>(<span class="type">double</span> re_, <span class="type">double</span> im_) : <span class="built_in">re</span>(re_), <span class="built_in">im</span>(im_) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> Complex <span class="keyword">operator</span> + (Complex obj1, Complex obj2) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Complex</span>(obj1.re + obj2.re, obj1.im + obj2.im);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> Complex <span class="keyword">operator</span> - (Complex obj1, Complex obj2) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Complex</span>(obj1.re - obj2.re, obj1.im - obj2.im);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> Complex <span class="keyword">operator</span> * (Complex obj1, Complex obj2) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Complex</span>(obj1.re * obj2.re - obj1.im * obj2.im, obj1.re * obj2.im + obj1.im * obj2.re);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; f[N], g[N], result[N]; <span class="comment">// 使用复数存储系数, 统一接口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到第一个 &gt;= num 的 2^n</span></span><br><span class="line"><span class="comment">// 因为要把 FFT 的工作长度对齐到 2 的幂次</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get2Power</span><span class="params">(<span class="type">int</span>&amp; result, <span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">    result = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (result &lt; num) &#123;</span><br><span class="line">        result &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个函数相当于一个DFT, 不过IDFT也要用, 所以直接叫做FFT</span></span><br><span class="line"><span class="comment">// 分治地计算 W * vector, 时间 O(n log n)</span></span><br><span class="line"><span class="comment">// arr 一开始存储系数, 计算完点值后直接覆盖 arr 返回 (反正系数没用了)</span></span><br><span class="line"><span class="comment">// isIDFT 表示在 IDFT, 如果是的话要用单位根的共轭做</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FFT</span><span class="params">(Complex* arr, <span class="type">int</span> len, <span class="type">bool</span> isIDFT)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (len &lt;= <span class="number">1</span>) &#123; <span class="comment">// 如果 f(x) = 3, 那么显然 f(x0) = 3 就是点值表达</span></span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 奇偶系数拷贝</span></span><br><span class="line">    Complex *odd = <span class="keyword">new</span> Complex [len&gt;&gt;<span class="number">1</span>];</span><br><span class="line">    Complex *even = <span class="keyword">new</span> Complex [len&gt;&gt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &amp; <span class="number">1</span>) odd[i &gt;&gt; <span class="number">1</span>] = arr[i];</span><br><span class="line">        <span class="keyword">else</span> even[i &gt;&gt; <span class="number">1</span>] = arr[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">FFT</span>(odd, len&gt;&gt;<span class="number">1</span>, isIDFT);</span><br><span class="line">    <span class="built_in">FFT</span>(even, len&gt;&gt;<span class="number">1</span>, isIDFT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造 len 次单位根 w</span></span><br><span class="line">    Complex w = <span class="built_in">Complex</span>(<span class="built_in">cos</span>(<span class="number">2</span>*PI/len), <span class="built_in">sin</span>(<span class="number">2</span>*PI/len));</span><br><span class="line">    <span class="comment">// 储存 w 的 n 次幂</span></span><br><span class="line">    Complex wPower = <span class="built_in">Complex</span>(<span class="number">1</span>, <span class="number">0</span>); </span><br><span class="line">    <span class="keyword">if</span> (isIDFT) w.im = -w.im; <span class="comment">// 取共轭</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// f(x) = a0 + a1 x + a2 x^2 + ...</span></span><br><span class="line">    <span class="comment">//      = (a0 + a2 x^2 + ...) + x (a1 + a3 x^2 + ...)</span></span><br><span class="line">    <span class="comment">//      = f1(x) + x f2(x)</span></span><br><span class="line">    <span class="comment">// f(-x) = (a0 + a2 x^2 + ...) - x (a1 + a3 x^2 + ...)</span></span><br><span class="line">    <span class="comment">//       = f1(x) - x f2(x)</span></span><br><span class="line">    <span class="comment">// 代入的点依次是 1, w, w^2, ..., 所以 wPower 就是当前带入的 x</span></span><br><span class="line">    <span class="comment">// f1 是 even, f2 是 odd</span></span><br><span class="line">    <span class="comment">// 注意这里合并时的顺序, 我们采用 1 i -1 -i (旋转顺序) 而不是 i -1 i -i</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; (len &gt;&gt; <span class="number">1</span>); i++) &#123;</span><br><span class="line">        arr[i] = even[i] + wPower * odd[i];</span><br><span class="line">        arr[i+(len&gt;&gt;<span class="number">1</span>)] = even[i] - wPower * odd[i];</span><br><span class="line">        wPower = wPower * w;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fft result, len = %d\n&quot;</span>, len);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;result re = %lf, im = %lf\n&quot;</span>, arr[i].re, arr[i].im);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> [] odd;</span><br><span class="line">    <span class="keyword">delete</span> [] even;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, resultLen;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// printf(&quot;N = %d\n&quot;, N);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// test complex</span></span><br><span class="line">    <span class="comment">// Complex a = Complex(3, 4);</span></span><br><span class="line">    <span class="comment">// Complex b = Complex(6, 5);</span></span><br><span class="line">    <span class="comment">// Complex c = a * b;</span></span><br><span class="line">    <span class="comment">// printf(&quot;c = %lf + i %lf&quot;, c.re, c.im);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// test PI</span></span><br><span class="line">    <span class="comment">// printf(&quot;pi = %lf&quot;, PI);</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>, &amp;f[i].re);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; ++i) <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>, &amp;g[i].re);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">get2Power</span>(resultLen, n+m+<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// printf(&quot;resultLen = %d\n&quot;, resultLen);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对齐之后超过的部分都是 0 不影响计算</span></span><br><span class="line">    <span class="built_in">FFT</span>(f, resultLen, <span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">FFT</span>(g, resultLen, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点值表达式的计算</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; resultLen; ++i)</span><br><span class="line">        result[i] = f[i] * g[i];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// printf(&quot;result = \n&quot;);</span></span><br><span class="line">    <span class="comment">// for (int i = 0; i &lt; resultLen; i++)</span></span><br><span class="line">    <span class="comment">//     printf(&quot;i=%d, re=%lf, im=%lf\n&quot;, i, result[i].re, result[i].im);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// IDFT</span></span><br><span class="line">    <span class="built_in">FFT</span>(result, resultLen, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 题目要求输出 n+m 个数</span></span><br><span class="line">    <span class="comment">// 注意正交那一步要除掉一个常数, 因为神秘精度问题还要 +0.5</span></span><br><span class="line">    <span class="comment">// result 理应是实数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n+m; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, <span class="built_in">int</span>(result[i].re/resultLen + <span class="number">0.5</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  </div>
</article>



    <div class="blog-post-comments">
        <div class="vcomment"></div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Articles</a></li>
        
          <li><a href="/links/">Links</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://chaofanlin.com">Academic Page</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Brute-Force"><span class="toc-number">3.</span> <span class="toc-text">Brute-Force</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Karatsuba"><span class="toc-number">4.</span> <span class="toc-text">Karatsuba</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%82%B9%E5%80%BC%E8%A1%A8%E7%A4%BA"><span class="toc-number">5.</span> <span class="toc-text">为什么要点值表示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DFT-%E9%AB%98%E6%95%88%E5%9C%B0%E4%BB%8E%E7%B3%BB%E6%95%B0%E8%A1%A8%E7%A4%BA%E5%88%B0%E7%82%B9%E5%80%BC%E8%A1%A8%E7%A4%BA"><span class="toc-number">6.</span> <span class="toc-text">DFT-高效地从系数表示到点值表示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IDFT-%E9%AB%98%E6%95%88%E5%9C%B0%E4%BB%8E%E7%82%B9%E5%80%BC%E8%A1%A8%E7%A4%BA%E5%88%B0%E7%B3%BB%E6%95%B0%E8%A1%A8%E7%A4%BA"><span class="toc-number">7.</span> <span class="toc-text">IDFT-高效地从点值表示到系数表示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%80%83%E6%80%BB%E7%BB%93"><span class="toc-number">8.</span> <span class="toc-text">思考总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTT"><span class="toc-number">9.</span> <span class="toc-text">NTT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">10.</span> <span class="toc-text">代码</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&text=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&title=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&is_video=false&description=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=分治艺术的顶点，快速傅里叶变换&body=Check out this article: https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&title=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&title=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&title=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&title=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&name=分治艺术的顶点，快速傅里叶变换&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://siriusneo.github.io/2022/03/04/%E5%88%86%E6%B2%BB%E8%89%BA%E6%9C%AF%E7%9A%84%E9%A1%B6%E7%82%B9%EF%BC%8C%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/&t=分治艺术的顶点，快速傅里叶变换"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2023
    Chaofan
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Articles</a></li><!--
     --><!--
       --><li><a href="/links/">Links</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://chaofanlin.com">Academic Page</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

<!-- Valine Comments -->

    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <script type="text/javascript">
        var notify = 'false' == true ? true : false;
        var verify = 'false' == true ? true : false;
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
        new Valine({
            el: '.vcomment',
            notify: notify,
            verify: verify,
            appId: "AyDHJHMfyHGtgF5Lc8CG4dpA-gzGzoHsz",
            appKey: "JZWLrweBHY4Txn5nZuLwFzim",
            avatar:"identicon",
            placeholder: "Send a comment for this post!",
            guest_info:guest_info,
            pageSize:"10"
        })
</script>


</body>
</html>
